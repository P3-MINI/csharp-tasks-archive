#include "GameSolver.h"
#include <iostream>
#include <algorithm>

#define PRINT_BOARD			//Zakomentuj, żeby wyłączyć wypisywanie rozwiązań

enum class TestType {
	OK, NoSolution
};

struct Test {
	TestType type;
	uint column_count;
	uint row_count;
	std::vector<uint> column_sum;
	std::vector<uint> row_sum;
	std::vector<Board> solutions;
};

bool boardComp(const Board& A, const Board& B)
{
	for (uint index_row = 0; index_row < A.size(); index_row++)
	{
		for (uint index_column = 0; index_column < A[index_row].size(); index_column++)
		{
			if (A[index_row][index_column] != B[index_row][index_column])
				return A[index_row][index_column] < B[index_row][index_column];
		}
	}
	return false;
}

bool boardEquiv(const Board& A, const Board& B)
{
	for (uint index_row = 0; index_row < A.size(); index_row++)
	{
		for (uint index_column = 0; index_column < A[index_row].size(); index_column++)
		{
			if (A[index_row][index_column] != B[index_row][index_column])
				return false;
		}
	}
	return true;
}

Test tests[] =
{
	/*1*/ { TestType::OK, 3, 3, {1, 1, 1}, {1, 1, 1}, {
		{{0, 0, 1}, {0, 1, 0}, { 1, 0, 0}},
		{{0, 0, 1}, {1, 0, 0}, { 0, 1, 0}},
		{{0, 1, 0}, {0, 0, 1}, { 1, 0, 0}},
		{{0, 1, 0}, {1, 0, 0}, { 0, 0, 1}},
		{{1, 0, 0}, {0, 0, 1}, { 0, 1, 0}},
		{{1, 0, 0}, {0, 1, 0}, { 0, 0, 1}},
	}},

	/*2*/ { TestType::NoSolution, 4, 3, {2, 3, 1, 1}, {5, 2, 0}},
	/*3*/ { TestType::NoSolution, 4, 4, {3, 2, 3, 0}, {3, 0, 4, 0}},
	/*4*/ { TestType::OK, 5, 5, {3, 2, 3, 1, 0}, {0, 3, 2, 4, 0}, {
		{{0, 0, 0, 0, 0}, {1, 1, 1, 0, 0}, {1, 0, 1, 0, 0}, {1, 1, 1, 1, 0}, {0, 0, 0, 0, 0}}
	}},

	/*5*/ { TestType::OK, 6, 5, {5, 1, 2, 1, 2, 1}, {6, 1, 2, 1, 2}, {
		{{1, 1, 1, 1, 1, 1},{1, 0, 0, 0, 0, 0},{1, 0, 0, 0, 1, 0},{1, 0, 0, 0, 0, 0},{1, 0, 1, 0, 0, 0}},
		{{1, 1, 1, 1, 1, 1},{1, 0, 0, 0, 0, 0},{1, 0, 1, 0, 0, 0},{1, 0, 0, 0, 0, 0},{1, 0, 0, 0, 1, 0}},
	}},

	/*6*/ { TestType::OK, 7, 7, {0, 2, 4, 1, 0, 4, 1}, {5, 0, 1, 2, 3, 0, 1}, {
		{{0, 1, 1, 1, 0, 1, 1},{0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 1, 0},{0, 0, 1, 0, 0, 1, 0},{0, 1, 1, 0, 0, 1, 0},{0, 0, 0, 0, 0, 0, 0},{0, 0, 1, 0, 0, 0, 0}},
		{{0, 1, 1, 1, 0, 1, 1},{0, 0, 0, 0, 0, 0, 0},{0, 0, 1, 0, 0, 0, 0},{0, 0, 1, 0, 0, 1, 0},{0, 1, 1, 0, 0, 1, 0},{0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 1, 0}}
	}},

	/*7*/ { TestType::OK, 8, 4, {0, 2, 4, 1, 0, 4, 1, 0}, {2, 4, 2, 4}, {
		{{0, 0, 1, 0, 0, 1, 0, 0},{0, 1, 1, 0, 0, 1, 1, 0},{0, 0, 1, 0, 0, 1, 0, 0},{0, 1, 1, 1, 0, 1, 0, 0}},
		{{0, 0, 1, 0, 0, 1, 0, 0},{0, 1, 1, 1, 0, 1, 0, 0},{0, 0, 1, 0, 0, 1, 0, 0},{0, 1, 1, 0, 0, 1, 1, 0}}
	}},

	/*8*/ { TestType::NoSolution, 8, 9, {5, 3, 1, 5, 0, 0, 1, 0}, {4, 0, 1, 2, 6, 0, 0, 2, 0}},

	/*9*/ { TestType::OK, 8, 9, {5, 3, 1, 5, 0, 0, 1, 0}, {4, 0, 1, 2, 4, 3, 0, 1, 0}, {
		{{1, 1, 0, 1, 0, 0, 1, 0},{0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 1, 0, 0, 0, 0},{1, 0, 0, 1, 0, 0, 0, 0},{1, 1, 1, 1, 0, 0, 0, 0},{1, 1, 0, 1, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0},{1, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0}},
		{{1, 1, 0, 1, 0, 0, 1, 0},{0, 0, 0, 0, 0, 0, 0, 0},{1, 0, 0, 0, 0, 0, 0, 0},{1, 0, 0, 1, 0, 0, 0, 0},{1, 1, 1, 1, 0, 0, 0, 0},{1, 1, 0, 1, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 1, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0}},
		{{1, 1, 1, 1, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 1, 0, 0, 0, 0},{1, 0, 0, 1, 0, 0, 0, 0},{1, 1, 0, 1, 0, 0, 1, 0},{1, 1, 0, 1, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0},{1, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0}},
		{{1, 1, 1, 1, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0},{1, 0, 0, 0, 0, 0, 0, 0},{1, 0, 0, 1, 0, 0, 0, 0},{1, 1, 0, 1, 0, 0, 1, 0},{1, 1, 0, 1, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 1, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0}}
	}},

	/*10*/ { TestType::OK, 10, 10, {0, 6, 2, 6, 0, 0, 5, 1, 0, 1}, {4, 4, 2, 0, 0, 4, 4, 0, 3, 0}, {
		{{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
		{{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 1, 1, 0, 0, 1, 0, 0, 0},{0, 1, 0, 1, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 1, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 1},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 1, 0, 1, 0, 0, 1, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0}}
	}},
};

int main()
{
	uint index_test = 0;

	for (const auto& test : tests)
	{
		std::cout << "Test " << ++index_test << std::endl;

		GameSolver solver(test.column_count, test.row_count, test.column_sum, test.row_sum);

		auto solutions = solver.Solve();

		if (test.type == TestType::NoSolution)
		{
			if (solutions.size() > 0)
				std::cout << "Error, solver found solution for board with no solution!" << std::endl;
			else
				std::cout << "OK, solver not found solution!" << std::endl;
			continue;
		}

		if (solutions.size() == 0) {
			std::cout << "Error, Solver did not find a solution!" << std::endl;
			continue;
		}

		if (solutions.size() != test.solutions.size())
		{
			std::cout << "Error, Solver did find only " << solutions.size() << " of " << test.solutions.size() << " solutions!" << std::endl;
			continue;
		}

		std::sort(solutions.begin(), solutions.end(), boardComp);
		int countOK = 0;
		for (uint i = 0; i < solutions.size(); i++) {

			if (!boardEquiv(solutions[i], test.solutions[i]))
				std::cout << "Error, diff " << i + 1 << std::endl;
			else
			{
				std::cout << "Solution no " << i + 1 << " is OK!" << std::endl;
				countOK++;
			}
		}
		if (countOK == test.solutions.size())
			std::cout << "OK, found all correct solutions! ";
		else
			std::cout << "Error, solver did not found all solutions! " << std::endl;

		std::cout << "(" << countOK << "/" << test.solutions.size() << ")" << std::endl;

#ifdef PRINT_BOARD
		for (const auto& solution : solutions)
		{
			solver.Print(test.column_count, test.row_count, test.column_sum, test.row_sum, solution);
		}
#endif // PRINT_BOARD
	}

	return 0;
}